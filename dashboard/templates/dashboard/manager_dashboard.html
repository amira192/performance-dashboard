{% extends 'base.html' %}
{% block title %}Manager Dashboard{% endblock %}
{% block content %}
<div class="grid md:grid-cols-3 gap-4">
  <div class="bg-white p-4 rounded shadow">
    <h3 class="text-sm text-gray-500">Total Employees</h3>
    <p class="text-2xl font-bold">{{ total_employees }}</p>
  </div>
  <div class="bg-white p-4 rounded shadow">
    <h3 class="text-sm text-gray-500">Pending Tasks</h3>
    <p class="text-2xl font-bold">{{ pending_tasks }}</p>
  </div>
  <div class="bg-white p-4 rounded shadow">
    <h3 class="text-sm text-gray-500">Completed Tasks</h3>
    <p class="text-2xl font-bold">{{ completed_tasks }}</p>
  </div>
</div>

<div class="mt-6 bg-white p-4 rounded shadow">
  <h4 class="font-semibold mb-2">Tasks per Employee</h4>
  <canvas id="managerChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
fetch("{% url 'manager_chart_data' %}")
  .then(res=>res.json())
  .then(data=>{
    const ctx=document.getElementById('managerChart').getContext('2d');
    new Chart(ctx,{
      type:'bar',
      data:{
        labels: data.labels,
        datasets:[
          { label:'Completed', data: data.completed },
          { label:'Pending', data: data.pending }
        ]
      },
      options:{ responsive:true }
    });
  });
</script>


<-- Export CSV/XLSX --!>

<a href="{% url 'export_tasks_csv' %}" class="btn">Export CSV</a>
{% if HAS_OPENPYXL %}
  <a href="{% url 'export_tasks_xlsx' %}" class="btn">Export Excel</a>
{% endif %}

{% endblock %}

