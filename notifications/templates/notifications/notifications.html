{% extends 'base.html' %}

{% block dashboard_content %}
<div class="max-w-3xl mx-auto bg-white rounded shadow p-6">
    <h2 class="text-2xl font-bold mb-4">Notifications</h2>

    <ul class="space-y-3">
        {% for notif in notifications %}
            <li class="p-3 rounded {% if not notif.is_read %}bg-blue-100{% else %}bg-gray-100{% endif %} flex justify-between items-center">
                <span>{{ notif.message }}</span>
                {% if not notif.is_read %}
                    <button
                        class="mark-read-btn bg-blue-500 text-white px-3 py-1 rounded text-sm"
                        data-id="{{ notif.id }}">
                        Mark as Read
                    </button>
                {% endif %}
            </li>
        {% empty %}
            <li class="text-gray-500">No notifications.</li>
        {% endfor %}
    </ul>
</div>

<script>
document.querySelectorAll('.mark-read-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const id = this.dataset.id;
        fetch("{% url 'mark_notification_read' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: 'id=' + id
        }).then(res => res.json())
          .then(data => {
            if (data.success) {
                btn.parentElement.classList.remove('bg-blue-100');
                btn.parentElement.classList.add('bg-gray-100');
                btn.remove();
            }
        });
    });
});
</script>
{% endblock %}
